<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>EcoScan - Plant Disease Detection & Carbon Calculator</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(to bottom right, #f0f9f0, #e6f0fa);
        color: #333;
        min-height: 100vh;
      }

      .container {
        width: 90%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      header {
        background-color: white;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 15px 0;
      }

      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 24px;
        font-weight: bold;
      }

      .logo-icon {
        color: #4caf50;
      }

      nav {
        display: flex;
        gap: 20px;
      }

      .nav-link {
        padding: 8px 16px;
        border-radius: 6px;
        text-decoration: none;
        color: #555;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .nav-link:hover {
        background-color: #f0f8f0;
        color: #4caf50;
      }

      .nav-link.active {
        background-color: #e6f4e6;
        color: #388e3c;
      }

      main {
        padding: 40px 0;
      }

      h1 {
        font-size: 36px;
        margin-bottom: 20px;
        text-align: center;
      }

      h2 {
        font-size: 28px;
        margin-bottom: 16px;
      }

      .subheading {
        text-align: center;
        font-size: 18px;
        color: #555;
        margin-bottom: 40px;
      }

      .card-container {
        display: flex;
        gap: 30px;
        flex-wrap: wrap;
        margin-bottom: 40px;
      }

      .card {
        background-color: white;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        flex: 1;
        min-width: 300px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      }

      .card-icon {
        height: 180px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .card-content {
        padding: 20px;
      }

      .card-title {
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 10px;
      }

      .card-text {
        color: #666;
        margin-bottom: 20px;
      }

      .btn {
        display: inline-block;
        padding: 10px 20px;
        border-radius: 6px;
        text-decoration: none;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.3s ease;
        border: none;
      }

      .btn-primary {
        background-color: #4caf50;
        color: white;
      }

      .btn-primary:hover {
        background-color: #388e3c;
      }

      .btn-secondary {
        background-color: #2196f3;
        color: white;
      }

      .btn-secondary:hover {
        background-color: #1976d2;
      }

      .uploader {
        height: 250px;
        border: 2px dashed #ccc;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background-color 0.3s ease;
        margin-bottom: 20px;
      }

      .uploader:hover {
        background-color: #f5f5f5;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
      }

      .form-input {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 16px;
        transition: border-color 0.3s ease;
      }

      .form-input:focus {
        border-color: #4caf50;
        outline: none;
      }

      .progress-container {
        height: 16px;
        background-color: #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
        margin: 15px 0;
      }

      .progress-bar {
        height: 100%;
        background-color: #4caf50;
        transition: width 0.3s ease;
      }

      .results-container {
        background-color: #f5f5f5;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
      }

      .footer {
        background-color: #333;
        color: white;
        padding: 40px 0 20px;
      }

      .footer-content {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 30px;
      }

      .social-links {
        display: flex;
        gap: 15px;
      }

      .social-icon {
        color: #ddd;
        font-size: 20px;
        transition: color 0.3s ease;
      }

      .social-icon:hover {
        color: white;
      }

      .copyright {
        font-size: 14px;
        color: #aaa;
        margin-top: 10px;
      }

      @media (max-width: 768px) {
        .card-container {
          flex-direction: column;
        }

        nav {
          display: none;
        }

        .mobile-menu-btn {
          display: block;
        }
      }
    </style>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"
      integrity="sha512-fD9DI5bZwQxOi7MhYWnnNPlvXdp/2Pj3XSTRrFs5FQa4mizyGLnJcN6tuvUS6LbmgN1ut+XGSABKvjN0H6Aoow=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
  </head>
  <body>
    <header>
      <div class="container">
        <div class="header-content">
          <div class="logo">
            <i class="fas fa-leaf logo-icon"></i>
            <span>EcoScan</span>
          </div>
          <nav>
            <a href="#home" class="nav-link active">Home</a>
            <a href="#plant" class="nav-link">Plant Scanner</a>
            <a href="#carbon" class="nav-link">Carbon Calculator</a>
            <!-- 'About' link removed -->
          </nav>
        </div>
      </div>
    </header>

    <main id="home">
      <div class="container">
        <h1>Empowering Sustainability Through Technology</h1>
        <p class="subheading">
          Identify plant diseases and track your carbon footprint with our
          advanced tools
        </p>

        <div class="card-container">
          <div class="card">
            <div class="card-icon" style="background-color: #e8f5e9">
              <i
                class="fas fa-camera"
                style="font-size: 64px; color: #4caf50"
              ></i>
            </div>
            <div class="card-content">
              <h3 class="card-title">Plant Disease Detection</h3>
              <p class="card-text">
                Upload photos of your plants and get instant diagnosis with
                treatment recommendations.
              </p>
              <a href="#plant" class="btn btn-primary">Scan Now</a>
            </div>
          </div>

          <div class="card">
            <div class="card-icon" style="background-color: #e3f2fd">
              <i
                class="fas fa-globe"
                style="font-size: 64px; color: #2196f3"
              ></i>
            </div>
            <div class="card-content">
              <h3 class="card-title">Carbon Footprint Calculator</h3>
              <p class="card-text">
                Track and reduce your environmental impact with our personalized
                carbon calculator.
              </p>
              <a href="#carbon" class="btn btn-secondary">Calculate Now</a>
            </div>
          </div>
        </div>

        <!-- Plant Scanner Section -->
        <section id="plant" style="margin-top: 60px">
          <h2>Plant Disease Detection</h2>
          <div class="card">
            <div class="card-content">
              <p>
                Upload photos of your plants and get an instant diagnosis from
                our AI-based model, including recommended treatments.
              </p>

              <div class="uploader" id="imageUploader">
                <i
                  class="fas fa-upload"
                  style="font-size: 32px; color: #aaa; margin-bottom: 10px"
                ></i>
                <p>Click to upload or drag and drop</p>
                <p style="font-size: 12px; color: #999">JPG, PNG or JPEG</p>
                <input
                  type="file"
                  id="fileInput"
                  style="display: none"
                  accept="image/*"
                />
              </div>

              <!-- Analyze Plant Button -->
              <button
                class="btn btn-primary"
                style="width: 100%; margin-bottom: 20px;"
                id="analyzePlantBtn"
              >
                <i class="fas fa-camera"></i> Analyze Plant
              </button>

              <!-- Disease Detection Results UI -->
              <div
                id="diseaseResults"
                style="display: none; background-color: #f9f9f9; 
                       border-radius: 6px; padding: 15px;"
              >
                <h4 style="margin-top: 0;">Disease Detection Result</h4>
                <p><strong>Plant:</strong> <span id="detectedPlant"></span></p>
                <p><strong>Disease:</strong> <span id="detectedDisease"></span></p>
                <p>
                  <strong>Remedy:</strong>
                  <span id="detectedRemedy"></span>
                </p>
              </div>
            </div>
          </div>
        </section>

        <!-- Carbon Calculator Section -->
        <section id="carbon" style="margin-top: 60px">
          <h2>Carbon Footprint Calculator</h2>
          <div class="card">
            <div class="card-content">
              <h3 style="margin-bottom: 20px">Enter Your Monthly Usage</h3>

              <div
                style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px"
              >
                <div class="form-group">
                  <label class="form-label" for="transportInput"
                    >Transportation (miles driven)</label
                  >
                  <input
                    type="number"
                    class="form-input"
                    placeholder="0"
                    id="transportInput"
                  />
                </div>

                <div class="form-group">
                  <label class="form-label" for="energyInput">Energy (kWh)</label>
                  <input
                    type="number"
                    class="form-input"
                    placeholder="0"
                    id="energyInput"
                  />
                </div>

                <div class="form-group">
                  <label class="form-label" for="foodInput"
                    >Food (% meat consumption)</label
                  >
                  <input
                    type="number"
                    class="form-input"
                    placeholder="0"
                    min="0"
                    max="100"
                    id="foodInput"
                  />
                </div>

                <div class="form-group">
                  <label class="form-label" for="consumptionInput"
                    >Consumption (new items purchased)</label
                  >
                  <input
                    type="number"
                    class="form-input"
                    placeholder="0"
                    id="consumptionInput"
                  />
                </div>
              </div>

              <!-- Results -->
              <div class="results-container">
                <h4 style="color: #1976d2; margin-top: 0; margin-bottom: 15px">
                  Your Carbon Footprint
                </h4>

                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 10px;
                  "
                >
                  <span>Total CO₂ Emissions:</span>
                  <span
                    style="font-weight: 500; font-size: 18px"
                    id="totalEmissions"
                  >
                    0 tons/year
                  </span>
                </div>

                <div class="progress-container">
                  <div
                    class="progress-bar"
                    id="footprintBar"
                    style="width: 0%;"
                  ></div>
                </div>

                <p style="font-size: 14px; margin-top: 10px" id="comparisonText">
                  Your footprint is 0% below the average.
                </p>

                <!-- Dynamic Tip Section -->
                <div
                  style="
                    background-color: white;
                    padding: 15px;
                    border-radius: 6px;
                    margin-top: 20px;
                  "
                >
                  <h5 style="margin-top: 0; margin-bottom: 10px">
                    Your Biggest Contributor:
                  </h5>
                  <p
                    id="primarySuggestion"
                    style="font-weight: 500; color: #333"
                  >
                    <!-- Will be filled dynamically -->
                  </p>

                  <hr
                    style="
                      border: none;
                      border-top: 1px solid #eee;
                      margin: 15px 0;
                    "
                  />

                  <h5 style="margin-top: 0; margin-bottom: 10px">
                    General Reduction Tips:
                  </h5>
                  <ul style="padding-left: 20px; margin-bottom: 0">
                    <li>
                      Consider carpooling or public transportation to reduce
                      driving emissions
                    </li>
                    <li>
                      Switch to energy-efficient appliances and LED lighting
                    </li>
                    <li>
                      Reduce meat consumption and opt for locally-sourced foods
                    </li>
                    <li>
                      Practice mindful consumption by repairing and reusing
                      items
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <footer class="footer">
      <div class="container">
        <div class="footer-content">
          <div>
            <div class="logo" style="margin-bottom: 10px">
              <i class="fas fa-leaf logo-icon" style="color: #4caf50"></i>
              <span>EcoScan</span>
            </div>
            <p class="copyright">© 2025 EcoScan. All rights reserved.</p>
          </div>

          <div class="social-links">
            <a href="#" class="social-icon"
              ><i class="fab fa-facebook-f"></i
            ></a>
            <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
            <a href="#" class="social-icon"><i class="fab fa-github"></i></a>
          </div>
        </div>
      </div>
    </footer>

    <script>
      // ---------------------------
      // 1. Navigation Link Handling
      // ---------------------------
      document.querySelectorAll(".nav-link").forEach((link) => {
        link.addEventListener("click", function () {
          document
            .querySelectorAll(".nav-link")
            .forEach((l) => l.classList.remove("active"));
          this.classList.add("active");
        });
      });

      // --------------------------------------------------
      // 2. Image Uploader + Storing Base64 for Plant API
      // --------------------------------------------------
      const uploader = document.getElementById("imageUploader");
      const fileInput = document.getElementById("fileInput");
      let uploadedBase64 = ""; // We'll store the base64 here

      uploader.addEventListener("click", () => {
        fileInput.click();
      });

      fileInput.addEventListener("change", (e) => {
        if (e.target.files.length) {
          const file = e.target.files[0];
          const reader = new FileReader();

          reader.onload = (event) => {
            // event.target.result is a Data URL: e.g. "data:image/png;base64,iVBOR..."
            uploader.innerHTML = `
              <img 
                src="${event.target.result}" 
                style="max-width: 100%; max-height: 200px; border-radius: 6px;"
              >
            `;
            uploader.style.border = "none";

            // We only want the raw base64, without the "data:image/xxx;base64," prefix
            const fullBase64 = event.target.result;
            const base64Parts = fullBase64.split(",");
            if (base64Parts.length === 2) {
              uploadedBase64 = base64Parts[1]; // the actual base64 string
            }
          };

          reader.readAsDataURL(file);
        }
      });

      // ---------------------------
      // 3. Real Plant Analysis
      // ---------------------------
      const analyzePlantBtn = document.getElementById("analyzePlantBtn");
      const diseaseResults = document.getElementById("diseaseResults");
      const detectedPlant = document.getElementById("detectedPlant");
      const detectedDisease = document.getElementById("detectedDisease");
      const detectedRemedy = document.getElementById("detectedRemedy");

      analyzePlantBtn.addEventListener("click", async () => {
        // Basic check
        if (!uploadedBase64) {
          alert("Please upload an image first.");
          return;
        }

        // Optionally show "Loading..." or disable the button here
        analyzePlantBtn.textContent = "Analyzing...";
        analyzePlantBtn.disabled = true;

        try {
          // Send request to the API
          const response = await fetch("https://susya.onrender.com", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ image: uploadedBase64 }),
          });

          if (!response.ok) {
            throw new Error("API request failed: " + response.status);
          }

          // Assume the API returns JSON
          const data = await response.json();
          // Example of expected data: 
          // {"plant": "Tomato", "disease": "Septoria leaf spot", "remedy": "Remove leaves..."}

          // Update the UI with results
          detectedPlant.textContent = data.plant || "Unknown";
          detectedDisease.textContent = data.disease || "Unknown";
          detectedRemedy.textContent = data.remedy || "No remedy found";

          // Show the results section
          diseaseResults.style.display = "block";
        } catch (error) {
          console.error("Error analyzing plant image:", error);
          alert("An error occurred while analyzing the image. Please try again.");
        } finally {
          // Re-enable button
          analyzePlantBtn.textContent = "Analyze Plant";
          analyzePlantBtn.disabled = false;
        }
      });

      // --------------------------------------------------
      // 4. Dynamic Carbon Calculator
      // --------------------------------------------------
      const transportInput = document.getElementById("transportInput");
      const energyInput = document.getElementById("energyInput");
      const foodInput = document.getElementById("foodInput");
      const consumptionInput = document.getElementById("consumptionInput");

      const totalEmissions = document.getElementById("totalEmissions");
      const footprintBar = document.getElementById("footprintBar");
      const comparisonText = document.getElementById("comparisonText");
      const primarySuggestion = document.getElementById("primarySuggestion");

      // Average baseline for comparison
      const AVERAGE_EMISSIONS = 10; // in tons/year (example baseline)

      // Add event listeners for real-time updates
      [transportInput, energyInput, foodInput, consumptionInput].forEach(
        (inputField) => {
          inputField.addEventListener("input", calculateCarbonFootprint);
        }
      );

      function calculateCarbonFootprint() {
        // 1. Get user inputs
        const miles = parseFloat(transportInput.value) || 0;
        const energy = parseFloat(energyInput.value) || 0;
        const meatPercent = parseFloat(foodInput.value) || 0;
        const consumption = parseFloat(consumptionInput.value) || 0;

        // 2. Apply placeholder formula
        const transportCO2 = miles * 0.0004;     // tons CO2
        const energyCO2 = energy * 0.0006;       // tons CO2
        const foodCO2 = (meatPercent / 100) * 2; // 2 tons/year if 100% meat
        const consumptionCO2 = consumption * 0.05; // 0.05 tons/item

        const totalCO2 = transportCO2 + energyCO2 + foodCO2 + consumptionCO2;

        // 3. Display the results
        totalEmissions.textContent = totalCO2.toFixed(2) + " tons/year";

        // 4. Compare with average
        const difference = AVERAGE_EMISSIONS - totalCO2;
        let comparisonMsg = "";

        if (difference > 0) {
          const percentBelow = (difference / AVERAGE_EMISSIONS) * 100;
          comparisonMsg = `Your footprint is ${percentBelow.toFixed(
            1
          )}% below the average of ${AVERAGE_EMISSIONS} tons per year.`;
        } else {
          const percentAbove = (Math.abs(difference) / AVERAGE_EMISSIONS) * 100;
          comparisonMsg = `Your footprint is ${percentAbove.toFixed(
            1
          )}% above the average of ${AVERAGE_EMISSIONS} tons per year.`;
        }

        comparisonText.textContent = comparisonMsg;

        // 5. Update progress bar
        const barFill = (totalCO2 / AVERAGE_EMISSIONS) * 100;
        let barPercentage = Math.min(Math.max(barFill, 0), 100);
        footprintBar.style.width = barPercentage + "%";

        // Change bar color if above average
        if (totalCO2 <= AVERAGE_EMISSIONS) {
          footprintBar.style.backgroundColor = "#4caf50"; // green
        } else {
          footprintBar.style.backgroundColor = "#f44336"; // red
        }

        // 6. Identify the biggest contributor & suggest action
        const categoryEmissions = {
          transport: transportCO2,
          energy: energyCO2,
          food: foodCO2,
          consumption: consumptionCO2,
        };

        let maxCategory = "";
        let maxValue = 0;

        for (const [key, value] of Object.entries(categoryEmissions)) {
          if (value > maxValue) {
            maxValue = value;
            maxCategory = key;
          }
        }

        // Provide targeted tips
        let dynamicTip = "";
        switch (maxCategory) {
          case "transport":
            dynamicTip = 
              "Transportation is your biggest source of CO₂. " +
              "Consider carpooling, using public transit, or switching to a fuel-efficient vehicle.";
            break;
          case "energy":
            dynamicTip = 
              "Energy use is your largest contributor. " +
              "Try lowering your thermostat, using LED bulbs, or installing solar panels if possible.";
            break;
          case "food":
            dynamicTip = 
              "Food consumption (especially meat) is your highest factor. " +
              "Reducing meat intake and choosing local, seasonal produce can lower this significantly.";
            break;
          case "consumption":
            dynamicTip = 
              "Purchasing new items has the biggest impact for you. " +
              "Try buying second-hand, repairing instead of replacing, and consuming more mindfully.";
            break;
          default:
            dynamicTip = "Your emissions are balanced. Keep up the good work!";
        }

        primarySuggestion.textContent = dynamicTip;
      }
    </script>
  </body>
</html>
